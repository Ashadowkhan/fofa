# Practical FOFA Asset Expansion: APT-C-23 Android Malware

![0](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/fofa%E5%B0%81%E9%9D%A2%E8%8B%B1%E6%96%87%E7%89%88.png)

## Overview

This content focuses on a deep analysis of the malicious activities of APT-C-23 on the Android platform.

APT-C-23, also known as Arid Viper, Micropsia, Frozen Cell, Desert Falcon, mainly targets educational institutions, military institutions, and other important areas related to Middle Eastern countries. The cyber-attack activities are mainly aimed at stealing sensitive information and have the ability to attack multiple platforms such as Windows, Android, and iOS. Attackers usually use custom mobile malware to collect sensitive information from the target and deploy other malware on infected devices.

Through the analysis of three publicly disclosed IOCs, this study uses FOFA for asset extension. **Since the 7 obtained results were not covered by threat intelligence platforms, reverse analysis was carried out on the malicious APP obtained from the extension to confirm the authenticity of the extension results.**

**In addition, through research and analysis, it has been found that the team mainly uses dating software for espionage. The malicious code of its application software is more hidden than the IOC source. The attacker makes it more difficult for users to discover this malicious behavior by continuously optimizing the Android code.**

## APT-C-23 Android IOC

The IOC comes from the articles "APT-C-23（双尾蝎）组织最新攻击活动分析" and "针对巴以地区围绕卡塔尔世界杯的攻击活动" from the 360 Threat Intelligence Center's Fenhuo Lab.

```
https://blaxaplayer.com/
https://www.bbalignit.com/
https://kora442.com/
```

## Extraction of FOFA Rules

According to the articles where the IOC was obtained, it can be clearly known that the method used by the APT-C-23 team is to modify some well-known APP applications and create corresponding phishing websites for payload delivery.

![1](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-1.png)

We first search for information related to the three phishing websites we obtained in FOFA.

![2](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-2.png)

According to the characteristics on FOFA, we can see that Blaxaplayer.com and bbalignit.com use the same certificate, but the certificate JARM fingerprint is not the same as kora442.com, so it cannot be used as a query rule.

Looking at other features, the two websites both use the LiteSpeed service, but no related content was found on kora442.com.

Therefore, we will focus on their website text. By viewing the website text and comparing the three phishing websites, we find that the beginning of the webpage contains the same features of keywords, description, and canonical.

![3](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-3.png)

These features are common, although they can be marked, but the results must be very large, so we need to continue to try to get other similar features from the original text of the website.
Check out the relevant parts of these three IOCs from their original text and find two features. One is getAppVersionOne(), and the other is getApp().

![4](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-4.png)

This is the prominent feature we found so far. We combine all the features to generate the FOFA query syntax. Please note here that special characters need to add escape characters.

```
status_code="200" && body="name=\"keywords\"" && body="name=\"description\"" && body="rel=\"canonical\""  && (body="onclick=\"getApp()\"" || body="onclick=\"getAppVersionOne()\"")
```

![5](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-5.png)

You can see that 60 pieces of data and 15 independent IPs have been circled. However, when we verify one by one, we find that there is still redundant data, so we need to optimize this query statement again.
Now you can lock on to js. Js is a very useful feature when looking for similar feature websites. So we continue to filter on the basis of the above query statement, adding similar myScript.js, note that this is also an or relationship.

```
status_code="200" && body="name=\"keywords\"" && body="name=\"description\"" && body="rel=\"canonical\"" && (body="onclick=\"getApp()\"" || body="onclick=\"getAppVersionOne()\"") && (body="src=\"js/myScript.js\"" || body="src=\"assets/js/myScript.js\"" || body="src=\"js/script.js\"")
```

![6](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-6.png)

In the end, 49 assets and 11 independent IPs were located.

After excluding the 3 phishing websites publicly available in the IOC and the phishing websites related to the World Cup, the remaining assets were deduplicated, and a total of 7 domain names were obtained, all of which were social application programs. However, in the process of further verifying the correctness of the results, we found a problem, so we need to verify the results of the extension one by one.

## Result Verification

For the discovered unknown IOC, further verification is needed, but when comparing, it is found that the new IOC found is basically not covered on the threat intelligence platform, so we verify the obtained results one by one to confirm the authenticity of the IOC. See the appendix for the final verification results.

![7](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-7.png)

Analyzing the extension results one by one, all websites use exactly the same template to display their content, only the content, title, and pictures are slightly different, and the page features are extremely similar to our known phishing websites.

![8](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-8.png)

According to the analysis in the article we referred to, the phishing websites all have the myscript.js feature.

![9](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-9.png)

### Thread Analysis 1

After analyzing the downloaded app, we found that the features of this app are not consistent with those in the source of IOC. There are no obvious code snippets like executecommands or WhatsApp information.

```
https://www.reblychat.com
https://clemochat.com
https://mail.wislisapp.com
https://mail.lapizachat.com
```

![10](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-10.png)

However, a connection may be gleaned from the report "Arid Viper disguising mobile spyware as updates for non-malicious Android applications" by the Cisco Threat Intelligence Research Team in October of the 23rd year.

The article says that some of the malware deployed by APT-C-23 uses Google's Firebase platform as the C2 infrastructure for malicious applications.

Firebase platform mainly serves as the C2 channel to issue commands as well as download and upload files. The platform can also provide the malware with new C2 server addresses, so it can switch from the Firebase platform to another attacker-controlled C2 host.

One of the Firebase projects used by Arid Viper in this campaign can be traced back to 2021, and there are some non-malicious mobile APKs associated with it. This indicates that the operator has been trying to create, test, and promote other APK software for many years.

![11](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-11.png) 

The team conducts espionage through a large number of dating software. The malicious code shown in the article was searched but no identical code snippets were found. It is suspected that the attacker has upgraded the code again to make the attack behavior more hidden.
Interestingly, among these apps, if one of the four apps is present, others cannot be installed. Therefore, these four apps can be judged to be the same set of apps in different skins.

![12](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-12.png) 


We installed the applications on the emulator, and even with the Google framework, we were still prompted to update Google Play services.

![13](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-13.png) 

And, these apps use the Firebase development platform, which is consistent with the description in the reference article.

![14](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-14.png) 

In the code prompting Google Play to update, you can see the presence of multiple languages. From this, it can be judged that the target group is quite clear.

![15](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-15.png) 

In addition, the getAntiSet method's ANTI_SET contains a large number of Android device antivirus software package names, and combines them through splicing.

![16](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-16.png) 

The checkValidation method in this class is used to determine whether to execute onchecked(true) by judging PackageManager.checkIfAppInstall.

![17](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-17.png) 

Tracking PackageManager.checkIfAppInstall, you can see that this method is used to check whether a specific application is installed on the device. The value passed in is the antivirus software package name mentioned above. When these antivirus software are not in the app, it returns true.

![18](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-18.png) 

Since our device does not have these antivirus software, the program executed onchecked(true) and finally returned true. Continue tracking to confirm the function of the code. It is used to confirm whether to update Google Play. When there is antivirus software, no update prompt is given. When there is no antivirus software, an update prompt is given.

![19](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-19.png) 

When we perform an update, the malicious update package updatte.apk is stored in the files folder of these apps. When the victim clicks update, it will automatically install the malicious program for the victim.

![20](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-20.png) 

After successful installation, it will record contact information.

![21](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-21.png) 

![22](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-22.png) 

![23](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-23.png) 

Then use the HttpManager.sendProcess method to transmit information.

![24](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-24.png) 

![25](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-25.png) 

The sent data packet is as follows, the above four domain names all exist in this interface apps/indx.php

![26](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-26.png) 

Analyzing the update.apk malicious program, its code is obfuscated, and it will request all permissions during installation.

![27](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-27.png) 

![28](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-28.png) 

At the same time, it will judge whether there is antivirus software in the Android device again.

![29](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-29.png) 

There are also some other character stitching behaviors.

![30](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-30.png) 

Some information can be found by stitching some character content.

![31](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-31.png) 

The OooO00o method is responsible for building HTTP POST requests, sending GZIP compressed JSON data, and handling responses.

![32](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-32.png) 

o00Oo0.OooOo is responsible for getting device information and uploading data to the server.

![33](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-33.png) 


![34](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-34.png) 

### Thread Analysis 2

Analyzing the remaining two apps, vovanil installation failed, and the js of the two app websites is consistent with the above suspicious js.

```
https://wobomov.com/
https://voevanil.com/
```

![35](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-35.png) 


The same routine, the same prompt needs to be updated during installation.

![36](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-36.png) 


The location of the prompt update code is found below.

![37](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-37.png)

Looking up its reference, the onResume method checks the camera permission and when the application named GConfig.PT_PACKAGE_NAME is not installed, it calls the above showCustomDialog2 method to display a custom dialog box prompting for version updates.

![38](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-38.png) 

Jumping to the place where GConfig.PT_PACKAGE_NAME is declared, the PT_PACKAGE_NAME field gets the final package name through splicing. After splicing, it shows that the package name is com.video.graphics. Therefore, this application will check whether another app is installed. If not, it will prompt to update and download com.video.graphics and install it for the user. The behavior pattern is consistent, so no further analysis is needed.

![39](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-39.png) 


### Thread Analysis 3

In addition to the above software, there is another phishing website targeting the World Cup in APT-C-23 in the data.

```
wcup22qat.com
```

![40](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-40.png) 

Viewing the original text of this website through FOFA, except for the description such as icon, title, etc., it is exactly the same as the features shown in IOC.

![41](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-41.png) 

![42](https://github.com/FofaInfo/Awesome-FOFA/blob/b5a26630505bd5e14880fcc8a7121301ca13415e/Storage/APT-C-23/c23-42.png) 

By analyzing the attack mode and code features of the above applications, they all conform to the characteristics of APT-C-23. Therefore, it can be judged that the above apps and World Cup related phishing websites are all APT-C-23 related assets.

## Summary

This research started with the analysis of 3 publicly available IOCs. Using FOFA's cyberspace mapping technology, we extended these IOCs. Because the 7 results obtained were not covered by threat intelligence platforms. Therefore, we decided to reverse analyze the malicious APP obtained by extension to confirm the authenticity of the extension results.

Through the extension analysis of some IOCs, we found that the team conducts espionage through a large number of dating software. The attacker has adopted very clever means, such as prompting to update Google Play store or software updates, to further plant malicious applications. Compared with the source of IOC, these malicious APP codes are more hidden and difficult to detect.

Attackers make it difficult for users to detect malicious behavior during normal use by continuously optimizing Android code, leading to personal information leakage. There are cybersecurity risks everywhere, like this malicious program disguised as dating software, it is a heavy disaster area for espionage worldwide.

## References

1. [Arid Viper disguising mobile spyware as updates for non-malicious Android applications](
https://blog.talosintelligence.com/arid-viper-mobile-spyware)
2. [针对巴以地区围绕卡塔尔世界杯的攻击活动](https://mp.weixin.qq.com/s/48Atw1b6Oe7A-vlsKHYWwg)
3. [APT-C-23（双尾蝎）组织最新攻击活动分析](https://mp.weixin.qq.com/s/NomfjAjGYdsOpLBtiOSZpA)

## Appendix

IOC:
```
blaxaplayer.com 
bbalignit.com
kora442.com
wcup22qat.com
reblychat.com
wobomov.com
voevanil.com
clemochat.com
wislisapp.com
lapizachat.com
```

Threat intelligence platform calibration situation:
IOCs in the reference article:

| Domain Name  | Weibo  | VirusTotal  | Qi Anxin  |
|:----------|:----------|:----------|:----------|
| blaxaplayer.com    | -    | Malicious    | APT-C-23    |
| bbalignit.com    | -    | Malicious    | -    |
| kora442.com    | -    | Malicious   | Android.Generic C&C    |

IOCs that came out of the extension:

| Domain Name  | Weibo  | VirusTotal  | Qi Anxin  |
|:----------|:----------|:----------|:----------|
| wcup22qat.com    | -    | -    | -    |
| reblychat.com    | -   | -    | -    |
| wobomov.com    | -    | Malicious    | -    |
| voevanil.com    | -    | -    | -   |
| clemochat.com    | -    | -    | -    |
| wislisapp.com    | -    | -    | -   |
| lapizachat.com    | -    | -    | -   |